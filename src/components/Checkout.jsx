import React, { useState } from 'react';
import { ShoppingBag, MapPin, Phone, User, CreditCard, Truck, Home } from 'lucide-react';
import { getImageUrl } from '../utilies';

const Checkout = ({ cartItems, onClose, onConfirmOrder }) => {
  const [formData, setFormData] = useState({
    fullName: '',
    phone: '',
    wilaya: '',
    commune: '',
    deliveryType: 'home' // 'home' or 'office'
  });

  const [errors, setErrors] = useState({});

  // Wilayas and their communes
  const wilayasWithCommunes = {
    'الجزائر': ['باب الواد', 'القصبة', 'سيدي امحمد', 'الحراش', 'برج الكيفان', 'بئر مراد رايس', 'الأبيار', 'بوزريعة', 'بئر خادم', 'المحمدية', 'حسين داي', 'القبة', 'باش جراح', 'الدار البيضاء', 'رويبة', 'الرويبة', 'الرغاية', 'باب الزوار', 'براقي', 'سطاوالي', 'زرالدة', 'شراقة', 'درارية', 'سوسطارة', 'تسالة المرجة', 'بني مراد', 'الأخضرية', 'خرايسية', 'عين طاية', 'حمام ملوان', 'بئر توتة', 'سيدي موسى', 'الحمامات', 'البرواقية', 'بوغرة', 'برج الإمام', 'عين البنيان', 'حمام ملوان', 'الدويرة', 'الكاليتوس', 'وادي السمار', 'سيدي عبد الله', 'الولجة', 'تسالة المرجة', 'العاشور', 'المرادية', 'بوفاريك', 'سيدي يحيى', 'المرسى'],
    'وهران': ['وهران', 'السانية', 'بئر الجير', 'مرسى الكبير', 'قديل', 'بوتليليس', 'عين الترك', 'المنصورة', 'بطيوة', 'مسرغين', 'الكرمة', 'السيق', 'سيدي الشامي', 'الأنصار', 'عين البية', 'العنصر', 'عين الكرمة', 'بني صاف', 'العامرية', 'وادي تليلات', 'سيدي بن يبقى', 'بن فريحة', 'حاسي البونية', 'حاسي مفسوخ', 'بوسفر', 'بن عبد المالك رمضان'],
    'قسنطينة': ['قسنطينة', 'زيغود يوسف', 'الخروب', 'عين اسمارة', 'حامة بوزيان', 'ديدوش مراد', 'ابن زياد', 'بن باديس', 'ابن عبد النور', 'مسعود بوجريو', 'الوليد', 'عين عبيد'],
    'سطيف': ['سطيف', 'العلمة', 'عين الكبيرة', 'بني عزيز', 'عين ولمان', 'بوقاع', 'الأولجة', 'عين أرنات', 'قجال', 'أولاد عدوان', 'بابور', 'قالمة', 'تيزي نبشار', 'مزلوق', 'صالح باي', 'أولاد تبان', 'عين الروى', 'دهماني', 'بوعنداس', 'بني ورتيلان', 'عموشة', 'تلة', 'السبيبة', 'جميلة', 'تاقديست', 'عين العباسة', 'العش', 'سردج', 'بني موحلي', 'عين لقراج', 'تاية', 'تيزي رنيف', 'المعاضيد', 'بئر العرش', 'بوطالب', 'بني فودة', 'بوغني', 'عين ازال', 'عين السبت', 'أولاد صابور', 'المجانة', 'هارزة', 'قجال', 'الصالحة', 'بئر حداده', 'عموشة', 'بني ورتيلان', 'تالة إيفاسن', 'بني شبانة', 'سلال', 'تينة', 'بئر القاضي', 'دراق', 'الرصفة', 'عين ولمان', 'قنزات', 'بن عزوز'],
    'عنابة': ['عنابة', 'برحال', 'سيدي عمار', 'الحجار', 'البوني', 'عين الباردة', 'شطايبي', 'الشريعة', 'عزابة', 'الذرعان', 'واد الانب', 'سرايدي'],
    'بليدة': ['البليدة', 'الشريعة', 'بوعرفة', 'الصومعة', 'بوفاريك', 'الأربعطاش', 'الشفة', 'بوقرة', 'بني مراد', 'بن خليل', 'سوحان', 'مفتاح', 'بني تامو', 'الوريجة', 'حمام ملوان', 'العفرون', 'واد جر', 'واد العلايق', 'موزاية', 'أولاد سلامة', 'صوما', 'بوارفة', 'أولاد يعيش', 'الشبلي', 'وادي الذهب'],
    'باتنة': ['باتنة', 'نقاوس', 'مروانة', 'سريانة', 'عريس', 'بريكة', 'جزار', 'تيمقاد', 'رأس العيون', 'تكوت', 'إشمول', 'بومقر', 'شير', 'معافة', 'تغنيف', 'عيون العصافير', 'شمرة', 'غسيرة', 'قصر بلزمة', 'زانة', 'أولاد عوف', 'أولاد سلام', 'مدوكل', 'تالخمت', 'إينوغيسن', 'ثنية العابد', 'بوزينة', 'القيقبة', 'العيون', 'جزار', 'سقانة', 'أولاد سي سليمان', 'إشملول', 'لمسان', 'لازرو', 'بولهيلات', 'أولاد فاضل', 'تازولت', 'بيطام', 'لمبيريك', 'اولاد معافة', 'الحاسي', 'واد الطاقة', 'وادي الشعبة', 'توزونت', 'بني فضالة الحقانية', 'أمدوكال', 'عين التوتة', 'أولاد عمر', 'منعة', 'بومية', 'أولاد علي', 'الإيفري', 'حيدوسة', 'تاكسلانت', 'قوريا', 'الرحبات', 'ارزقي'],
    'تيزي وزو': ['تيزي وزو', 'عين الحمام', 'تيقزيرت', 'ذراع بن خدة', 'بني دوالة', 'آزفون', 'أقني-غغران', 'واضية', 'تيرمتين', 'فريحة', 'مكيرة', 'ذراع الميزان', 'تيزي راشد', 'أيت يني', 'بني زيكي', 'أولاد غراد', 'تيمزريت', 'معاتقة', 'أقبيل', 'إيفليسن', 'تيزي نتلاتة', 'بوغني', 'إليلتن', 'بوجيمة', 'أيت أوقورت', 'أبي يوسف', 'بني عيسى', 'أكفادو', 'جبر مقرنين', 'واسيف', 'إعزوزن', 'إيفرحونن', 'أيت زمنزر', 'أيت يحيى', 'بني عيدل', 'سوق الإثنين', 'يطافن', 'أيت عقاية', 'اعكرن', 'بن عيسى لوافي', 'أمليح', 'عين الزاوية', 'أزلاغ', 'فريقات', 'المعشالي', 'أكبو', 'أيت شافعة', 'سوق الإثنين', 'عزازقة', 'بني زمنزر', 'أيت قاسي', 'سيدي نعمان', 'تادماي تواورت', 'بوذفار', 'أيت بومهدي', 'مشترة', 'تالا أثمان', 'أيت محمود', 'أيت شبانة', 'أيت ورثيلان', 'بني زكي', 'تيمزريت', 'ذراع العابد'],
    'بجاية': ['بجاية', 'أقبو', 'تيشي', 'صدوق', 'آيت سماعيل', 'فريحة', 'خراطة', 'سيدي عيش', 'تيملالين', 'أمالو', 'سوق الأحد', 'تاوريرت اغيل', 'باربشة', 'آيت جليل', 'آمزيل', 'سيدي ايش', 'أقبو', 'تيفرا', 'باربشة', 'فناية الماثن', 'قصر', 'شميني', 'أمزيون', 'باربشة', 'تيزي نبيشر', 'آيت الرزين', 'سوق اوفلة', 'بني معوش', 'بوحمزة', 'تيمزريت', 'بوجليل', 'بني قاسم', 'تينبدار', 'سطا', 'بوحمام', 'أدكار', 'شلاطة', 'الصومعة', 'تامقرة', 'إيفلاسن', 'تواجة', 'أدرار ناثيرثان', 'آيت رزين', 'توادا', 'أوقاس', 'بني حبيبي', 'تمريجت', 'اغريب امقران', 'أيت عيسى امحمد', 'بوخليفة', 'بني خليل', 'بني ملكيش'],
    'تلمسان': ['تلمسان', 'المنصورة', 'الغزوات', 'شتوان', 'مغنية', 'رمشي', 'ندرومة', 'الرمشي', 'العريشة', 'سبرة', 'بني سنوس', 'بني بوسعيد', 'الحناية', 'بني مستار', 'السهلة', 'سبع شيوخ', 'بني وارسوس', 'مرسى بن مهيدي', 'فلاوسن', 'الهنايا', 'باب العسة', 'بني خدة', 'سيدي الجيلالي', 'سيدي مجاهد', 'الشقفة', 'العزايل', 'بن سكران', 'أولاد ميمون', 'عين تلوت', 'الرمشي', 'زناتة', 'ترنى', 'عين النحالة', 'بني صميل', 'عين غرابة', 'صبرة', 'بني بهدل', 'الوريتة', 'العقيد لطفي', 'عين فتاح', 'دار يغمراسن', 'الفحول', 'عين فزة', 'سيدي عبد الله', 'عين الكبيرة', 'الحناية', 'بني بحدل', 'بوحلو', 'السواني', 'سيدي عبد الله', 'عين قزام'],
    'تيارت': ['تيارت', 'السوقر', 'مهدية', 'فرندة', 'مشرع اسفاء', 'عين ذهب', 'رحوية', 'قصر الشلالة', 'قرطوفة', 'سوق الأحد', 'مدريسة', 'دحموني', 'سيدي علي ملال', 'عين بوشقيف', 'بن مالك عمر', 'عين الحديد', 'عين كرمس', 'جيلالي بن عمار', 'سيدي عابد', 'زمالة الأمير عبد القادر', 'تاقدمت', 'سي عبد الغني', 'سبيعات', 'وادي ليلي', 'ملاكو', 'سيدي حسني', 'رشايقة', 'سرغين', 'بوقرة', 'العين الباردة', 'تيدة', 'شحيمة', 'ذراع بن يحي', 'مجبر', 'ندرومة', 'تاخمارت', 'شقرة', 'فايجة', 'عين الطيبي', 'توسنينة', 'عين زريت', 'خنق ماضي'],
    'أدرار': ['أدرار', 'رقان', 'تيميمون', 'أولف', 'تيط', 'سالي', 'أقبلي', 'شروين', 'السبع', 'أوقروت', 'أولاد سعيد', 'فنوغيل', 'تامنطيت', 'تامست', 'انزجمير', 'أولاد أحمد تيمي', 'بودة', 'المطارفة', 'أولاد عيسى', 'تسابيت', 'تيمقطن', 'طالمين', 'قصر قدور', 'زاوية كنتة', 'تمنطيط', 'تينركوك', 'دلدول', 'الشروين'],
    'الشلف': ['الشلف', 'تنس', 'بنايرية', 'الكريمية', 'تاجنة', 'أبو الحسن', 'الزبوجة', 'وادي سلي', 'أولاد بن عبد القادر', 'بوقادير', 'الهرانفة', 'حرشون', 'وادي قوسين', 'الصبحة', 'عين مران', 'سيدي عكاشة', 'بوزغاية', 'الدهمة', 'أولاد عباس', 'سيدي عبد الرحمان', 'المرسى', 'وادي الفضة', 'ام الدروع', 'بني حواء', 'أم الذروع', 'سنجاس', 'برياح', 'شطية', 'بني راشد', 'بني بوعتاب', 'الأبيض مجاجة', 'وادي غوسين', 'الحرانفة', 'تاوقريت', 'مصدق'],
    'الأغواط': ['الأغواط', 'قصر الحيران', 'عين ماضي', 'الغيشة', 'بريدة', 'أفلو', 'سيدي مخلوف', 'حاسي الدلاعة', 'حاسي الرمل', 'عين سيدي علي', 'سبقاق', 'تاجرونة', 'الحويطة', 'الخنق', 'قلتة سيدي سعد', 'عين فكة', 'تاجموت', 'واد مورا', 'واد مزي', 'الحاج المشري', 'سيدي بوزيد', 'بن ناصر بن شهرة', 'تاويالة', 'البيضاء'],
    'أم البواقي': ['أم البواقي', 'عين البيضاء', 'عين الكرشة', 'عين مليلة', 'بحير الشرقي', 'الضلعة', 'فكرينة', 'سيقوس', 'مسكيانة', 'عين ببوش', 'عين الفكرون', 'الرحية', 'القصور', 'بلالة', 'عين فاكرون', 'زرق العوينات', 'أولاد حملة', 'حاسي لخنافيس', 'أولاد زواي', 'عين الديس', 'عين قزام', 'الذهب', 'عين كرشة', 'بئر الشهداء', 'مشروحة', 'واد نيني', 'أولاد سيدي عبد الرزاق'],
    'بسكرة': ['بسكرة', 'طولقة', 'سيدي عقبة', 'الشعيبة', 'المزيرعة', 'أورلال', 'مشونش', 'القنطرة', 'جمورة', 'فوغالة', 'سيدي خالد', 'أوماش', 'براني', 'الحوش', 'الدوسن', 'لوطاية', 'الزريبة الوادي', 'الفيض', 'عين الناقة', 'بوشقرون', 'مليلي', 'بسباس', 'عين زعطوط', 'خنقة سيدي ناجي', 'أولاد جلال', 'الوطة', 'الحاج بشير', 'الغروس', 'خنقة سيدي نايل', 'عين الطويلة', 'عزقة', 'الليوة', 'البشري'],
    'بشار': ['بشار', 'أبادلة', 'بني ونيف', 'تاغيت', 'العبادلة', 'كرزاز', 'القنادسة', 'ايش', 'تينكرطين', 'بني عباس', 'جرف الطرفاية', 'مريجة', 'المخريز', 'موغل', 'قصابي', 'بوكايس', 'بوعلام', 'لحمر', 'تيمودي', 'بوسمغون', 'أولاد خضير', 'أولاد سيدي الشيخ الغربية', 'صفيصيفة', 'أم العسل', 'بوزيان'],
    'البويرة': ['البويرة', 'سور الغزلان', 'القادرية', 'الأخضرية', 'برج أخريص', 'عين بسام', 'البردج', 'الهاشمية', 'حيزر', 'المعمورة', 'بشلول', 'الاسنام', 'عين تادلس', 'عين بوسيف', 'بسكرة', 'عمر', 'واد الدحب', 'زبربر', 'أهل القصر', 'أيت المان', 'معالة', 'أولاد راشد', 'عين الطويلة', 'رافور', 'رداس', 'جعافرة', 'سبالت', 'تيفرة', 'تاغزوت', 'عقبو', 'أولاد حيلوش', 'حسناوة', 'الأزهري', 'المنصورة', 'ديرة', 'مزدور', 'بشلول', 'عزريال', 'رقايز', 'عين العلوي', 'عين سيدي البخاري', 'عين اللازم', 'بني سليمان'],
    'تمنراست': ['تمنراست', 'عبد المازي', 'عين قزال', 'انقيسه', 'تيت', 'تزروك', 'مرتوك', 'تين الزاوية', 'عين قنان', 'تافدست', 'عين امقل'],
    'تبسة': ['تبسة', 'بئر العاتر', 'الشريعة', 'الماء الابيض', 'نقرين', 'بوخضرة', 'العقلة', 'الونزة', 'الحمامات', 'مرسط', 'بئر مقدم', 'العويينات', 'فركان', 'السفسيفة القبلية', 'الكويف', 'ثليجة', 'العقلة الملحة', 'العش', 'الأوينات', 'بئر الذهب', 'قورين', 'الشريعة', 'عزور', 'ستاح قنطيس', 'بجن', 'بولحاف الدير', 'حمام الصالحين', 'الزعرورية'],
    'تندوف': ['تندوف', 'أم العسل', 'أوم العسل'],
    'تيسمسيلت': ['تيسمسيلت', 'تاملاحت', 'بوقرة', 'برج بونعامة', 'ثنية الأحد', 'بني شعيب', 'الأعبادية', 'سيدي عابد', 'خميستي', 'عماري', 'يوسفية', 'سيدي بوتوشنت', 'مليانة', 'برج الأمير عبد القادر', 'سيدي سليمان', 'لرجام', 'المعاصم', 'سيدي عيسى', 'سيدي لحسن', 'بوعيشون', 'أولاد بسام', 'لزيونة'],
    'الوادي': ['الوادي', 'الرباح', 'كوينين', 'المقرن', 'الطالب العربي', 'دبيلة', 'حساني عبد الكريم', 'سيدي عون', 'الرقيبة', 'طريفاوي', 'المغير', 'جامعة', 'تندلة', 'سطيل', 'حاسي خليفة', 'الطريفاوي', 'الوقف', 'الدبيلة', 'اوغلة', 'نخلة', 'مرارة', 'بياضة', 'باعزو', 'الطالب الحربي', 'سيدي خليل', 'سيدي عمران', 'حمرايا', 'العقلة', 'البياضة', 'سيدي مسطور'],
    'خنشلة': ['خنشلة', 'متوسة', 'قايس', 'بابار', 'الحامة', 'عين طويلة', 'ولتام', 'أولاد رشاش', 'الرميلة', 'شليعة', 'ام الطيور', 'جلال', 'شاشار', 'شتمة', 'بوحمامة', 'اولاد رشاش', 'يابوس', 'برج الغدير', 'طامزة', 'نسيجة', 'لمحمل'],
    'سوق أهراس': ['سوق أهراس', 'سدراتة', 'المشروحة', 'تاورة', 'خميسة', 'الزعرورية', 'مداوروش', 'اولاد ادريس', 'بئر بوحوش', 'أم العظام', 'تيفاش', 'عين الزانة', 'الويلان', 'الدريعة', 'الحدادة', 'المراهنة', 'ولجة السحنة', 'معاوية', 'أولاد محله', 'هنانشة', 'زعرورية', 'راقوبة', 'القلال', 'قصر الجير', 'عين سويس', 'الزوابي'],
    'تيبازة': ['تيبازة', 'شرشال', 'القليعة', 'حجوط', 'الدويرة', 'بوحارون', 'سيدي راشد', 'الناصرية', 'حمر العين', 'بوهارون', 'بوركيكة', 'الشعيبة', 'سيدي عمر', 'بوسماعيل', 'الأحمر العين', 'أحمر العين', 'سيدي سميان', 'بني ميلك', 'بوعينان', 'سوفير', 'حاطوس', 'الرويبة', 'فوكة', 'مناصر', 'بوجار', 'العفرون', 'الأرهاط', 'قرواو'],
    'ميلة': ['ميلة', 'فرجيوة', 'شلقوم', 'التلاغمة', 'قرارم قوقة', 'رواشد', 'بوحاتم', 'السيقر', 'عين بيضاء هراوة', 'عين مليلة', 'أحمد راشدي', 'الشيقارة', 'بوهاتم', 'الياشير', 'عين بوزيان', 'وادي العثمانية', 'بوفرغ', 'زغاية', 'الرواشد', 'أمجاز إديمام', 'عين تين', 'تسدان حدادة', 'درمل', 'سيدي خليفة', 'الكراش', 'واد العثمانية', 'تيبيرقنت', 'عين البيضاء', 'الغربي', 'مينار زارزة', 'الرواشد', 'تاوريرت', 'سيدي مروان'],
    'عين الدفلى': ['عين الدفلى', 'خميس مليانة', 'رويينة', 'دجندل', 'العبادية', 'بوريدة', 'عين بوسيف', 'عين ليحيا', 'ذراع الميزان', 'مكتارة', 'بني راشد', 'الماين', 'أولاد شيخ', 'مليانة', 'عريب', 'برباط', 'حمام ريغة', 'عين سلطان', 'جديوية', 'سيدي لخضر', 'عين توريك', 'تاشتة الزقاقطة', 'البطحية', 'حوض الشرقي', 'الخضارة', 'العامرة', 'بني تامو', 'حمام المجة', 'بربوش', 'حسان'],
    'النعامة': ['النعامة', 'عين الصفراء', 'محرف', 'سفيسفة', 'القصيدي', 'دائرة أسلة', 'تيوت', 'عسلة', 'تارين الزياتنة', 'عين البن', 'الماري بن شنيب', 'مكمن بن عمار'],
    'عين تموشنت': ['عين تموشنت', 'حمام بوحجر', 'بني صاف', 'العامرية', 'الأمير عبد القادر', 'الملح', 'سيدي بن عدة', 'اولاد قيبة', 'العقلة', 'الحساسنة', 'واد الصباح', 'السبعة شيوخ', 'القضية', 'المزاورية', 'سيدي اوريات', 'سيدي سعيد', 'أولاد بوجمعة', 'اغيلزان', 'سيدي بوبكر', 'تروشت', 'حاسي الغلة', 'السواني', 'شهيدة', 'بوركيكة', 'بوحلو', 'اولاد بوعون', 'الزقواط', 'الطهر'],
    'غرداية': ['غرداية', 'زلفانة', 'المنيعة', 'بريان', 'القرارة', 'ضاية بن ضحوة', 'المنصورة', 'بني يزقن', 'بونورة', 'حاسي الفحل', 'حاسي القارة', 'متليلي الشعانبة'],
    'غليزان': ['غليزان', 'جديوية', 'واد ارهيو', 'عين الطارف', 'سيدي سعادة', 'رمكة', 'زمورة', 'يلل', 'بولحاف', 'المطمر', 'قلعة بن حمادة', 'بن داود', 'الوادي الرحي', 'قوريان', 'بني دريدة', 'بني زنتيس', 'سيدي محمد بن عودة', 'عين طاوشة', 'بني زنتيس', 'المدية', 'واد السلي', 'مازونة', 'عين الشقرا', 'عين الرحمة', 'سيدي امحمد بن علي', 'حد الشكالة', 'واد سلى', 'بني بوعتاب', 'سيدي خطاب', 'وادي رهيو'],
    'جيجل': ['جيجل', 'الطاهير', 'الميلية', 'الشقفة', 'سيدي معروف', 'العنصر', 'سيدي عبد العزيز', 'القنار', 'أميوش', 'أولاد عياد', 'الأنصار', 'بورقلة', 'الأحجار الزرق', 'الزيامة المنصورية', 'السطارة', 'جيملة', 'شقفة', 'برج الطهر', 'بوسيف أولاد سكار', 'بودرياس الطهر', 'تاكسنة', 'البلدة الميمونة', 'سلمة بن زياد', 'الكراطة', 'غبالة', 'العوانة', 'قاوس', 'الحامة'],
    'المسيلة': ['المسيلة', 'بوسعادة', 'بن سروال', 'سيدي عيسى', 'المعاضيد', 'الهامل', 'السوامع', 'حمام الضلعة', 'اولاد دراج', 'عين الخضرة', 'ونوغة', 'عين الحجل', 'المطارفة', 'بئر فضة', 'الحوامد', 'عين الفارس', 'مقرة', 'تارمونت', 'بن سرور', 'خبانة', 'عين الريش', 'جنات', 'اولاد سيدي براهيم', 'عين القصير', 'اولاد عدي الكراكدة', 'الغليمة', 'شلال', 'محمد بوضياف', 'بير قصد علي', 'سليم', 'تمسة', 'زرزور', 'امالوك', 'الربح', 'الغلمة', 'بوطي السايح', 'اولاد مانصور', 'السنسيل', 'سيدي هجرس', 'تامنت', 'الطيحات', 'ام العظام', 'بئر خادم'],
    'مستغانم': ['مستغانم', 'حاسي ماماش', 'عين تادلس', 'عين نوسي', 'سيدي علي', 'مازغران', 'خير الدين', 'صور', 'الصفصاف', 'سيدي لخضر', 'عين سيدي الشريف', 'واد الخير', 'الصفصاف', 'سيدي بلعاطر', 'بوقيرات', 'عشعاشة', 'حساين', 'فرناكة', 'سيدي عبد المجيد', 'الناضورة', 'مزغران', 'سيدي البشير', 'بن عبد المالك رمضان', 'مصرة', 'عين بودينار', 'عين المذاور', 'طواهرية', 'قويرات هجاج', 'المنور', 'ستيدية', 'خضرة', 'بوزطون', 'الصور'],
    'معسكر': ['معسكر', 'تيزي', 'سيق', 'سيدي قادة', 'فروحة', 'عين فكان', 'بوحنيفية', 'الغمري', 'عين فارس', 'سيدي عبد الجبار', 'تيغنيف', 'الحشم', 'القرطيف', 'عين فكرون', 'واد التاغية', 'محمدية', 'الهشيمة', 'خليف', 'نسمث', 'سيدي بوجنان', 'عين فرح', 'الظهرة', 'البطحة', 'الكرط', 'سيدي مبارك', 'النضر', 'عين فكان', 'سيدي صافية', 'سمامة', 'عين الهجل', 'الجبل', 'مقطع دوز', 'سيدي امحمد بن علي', 'شلالة', 'الشهايدية', 'سيدي عبد الرحمان', 'تافسير', 'مامونية', 'الرقراقة', 'الشهيد', 'عين فكرون', 'زلامطة', 'البرج', 'بني زنطيس', 'واريزان'],
    'ورقلة': ['ورقلة', 'الحجيرة', 'النخيل', 'حاسي مسعود', 'رويست', 'عين البيضاء', 'تقرت', 'تماسين', 'سيدي سليمان', 'بن ناصر', 'المقرن', 'الطيبات', 'سيدي الخويلد', 'الحجر', 'انقوصة', 'الدواية', 'باسي الحواس', 'المنقر', 'ورماس', 'الرويسات', 'الرويسات', 'واد رمل'],
    'البيض': ['البيض', 'بوغطاط', 'الأبيض سيدي الشيخ', 'بريزينة', 'رقاصة', 'العابد', 'ستيتن', 'القعدة', 'كراكدة', 'كاف الدخائرية', 'غساسلة', 'بنصر الدين', 'شللة', 'عين الابل'],
    'إيليزي': ['إيليزي', 'جانيت', 'دبداب', 'برج عمر ادريس', 'برج الحواس'],
    'برج بوعريريج': ['برج بوعريريج', 'برج زمورة', 'المنصورة', 'رأس الوادي', 'حرازة', 'المهير', 'عين تاغروت', 'البردج', 'الهاشمية', 'غيلاسة', 'تنت', 'قلة', 'غيدة', 'تازمالت', 'عاشور', 'الماين', 'عين تسرة', 'خلويا', 'الحمادية', 'الزباريرية', 'جعافرة', 'الصور', 'دونا', 'الطبوش', 'ثنية النصر', 'عين الرحمة', 'برج الغدير', 'تاغليت', 'مجانة', 'الرزاقنية', 'الماشرق', 'بن داود', 'عين الفيلة', 'برج الغدير'],
    'بومرداس': ['بومرداس', 'دلس', 'بودواو', 'ثنية الحد', 'برج منايل', 'بغلية', 'تيجلابين', 'الخرايسية', 'الثنية', 'الناصرية', 'سيدي داود', 'حمادي', 'بومعرة', 'قورصو', 'الخروبة', 'عين كمال', 'لاربعطاش', 'البحري', 'عمال', 'يسر', 'جنات', 'كور الشيخ', 'سوق الحد', 'لقاطة', 'بني عمران', 'بوزقزة', 'تيمزريت', 'سي مصطفى', 'عفير', 'شعبة العامر', 'تاورقة', 'الرغاية', 'زموري', 'واد مارز'],
    'الطارف': ['الطارف', 'بسباس', 'بوحجر', 'الذرعان', 'بوثلجة', 'عين الكرمة', 'الشافية', 'الشط', 'عصفور', 'زرارة', 'بن مهيدي', 'شحاني', 'الشحاني', 'بين الويدان', 'السوارخ', 'الأيون', 'عين العسل', 'القالة', 'عين الزرقاء', 'حمام بني صالح', 'واد الزيتون', 'شيحاني', 'رمضان الجمال'],
    'تيميمون': ['تيميمون', 'شروين', 'تالمين', 'أولاد سعيد', 'طالمين', 'قصر قدور', 'قصر القديم', 'شعلاف', 'أولاد ابراهيم', 'تيمقطن'],
    'برج باجي مختار': ['برج باجي مختار', 'تيمياوين', 'تين الزاوية'],
    'أولاد جلال': ['أولاد جلال', 'الوادي', 'الدوسن', 'المزيرعة'],
    'بني عباس': ['بني عباس', 'قورارة', 'المطرف', 'بني عباس'],
    'عين صالح': ['عين صالح', 'فقارة الزوا', 'عين قيزان'],
    'عين قزام': ['عين قزام', 'طهركوت', 'عين قزام'],
    'تقرت': ['تقرت', 'تماسين', 'تبسة', 'الزاوية العابدية', 'سيدي البخاري'],
    'جانت': ['جانت', 'برج الحواس'],
    'المغير': ['المغير', 'جامعة', 'سيد عون'],
    'المنيعة': ['المنيعة', 'حاسي قارة', 'حاسي فحل', 'منصورة']
  };

  // Calculate totals
  const subtotal = cartItems.reduce((acc, item) => {
    const price = parseInt(item.price.replace(/\D/g, ''));
    return acc + (price * (item.quantity || 1));
  }, 0);

  const deliveryFee = 0; // Free delivery
  const total = subtotal + deliveryFee;

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value,
      // Reset commune when wilaya changes
      ...(name === 'wilaya' && { commune: '' })
    }));
    // Clear error when user starts typing
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  const validateForm = () => {
    const newErrors = {};
    
    if (!formData.fullName.trim()) {
      newErrors.fullName = 'الرجاء إدخال الاسم الكامل';
    }
    
    if (!formData.phone.trim()) {
      newErrors.phone = 'الرجاء إدخال رقم الهاتف';
    } else if (!/^(05|06|07)[0-9]{8}$/.test(formData.phone.replace(/\s/g, ''))) {
      newErrors.phone = 'رقم الهاتف غير صحيح';
    }
    
    if (!formData.wilaya) {
      newErrors.wilaya = 'الرجاء اختيار الولاية';
    }
    
    if (!formData.commune) {
      newErrors.commune = 'الرجاء اختيار البلدية';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    
    if (validateForm()) {
      // Generate random order number
      const orderNumber = 'ND' + Math.random().toString(36).substring(2, 10).toUpperCase();
      
      const orderData = {
        orderNumber,
        ...formData,
        items: cartItems,
        subtotal,
        deliveryFee,
        total,
        date: new Date().toISOString()
      };
      
      onConfirmOrder(orderData);
    }
  };

  // Get communes for selected wilaya
  const communes = formData.wilaya ? wilayasWithCommunes[formData.wilaya] || [] : [];

  return (
    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-50">
      {/* Header */}
      <div className="sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <button
              onClick={onClose}
              className="text-gray-600 hover:text-gray-900"
            >
              ← رجوع
            </button>
            <h1 className="text-2xl font-black text-dark">إتمام الطلب</h1>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-8 max-w-6xl">
        <div className="grid md:grid-cols-2 gap-8">
          {/* Order Form */}
          <div className="space-y-6">
            <form onSubmit={handleSubmit} className="space-y-6">
              {/* Customer Information */}
              <div className="bg-white rounded-xl p-6 shadow-sm">
                <h2 className="text-xl font-bold text-right mb-6 flex items-center justify-end gap-2">
                  <User size={24} />
                  معلومات الزبون
                </h2>

                {/* Full Name */}
                <div className="mb-4">
                  <label className="block text-right text-gray-700 font-bold mb-2">
                    الاسم الكامل *
                  </label>
                  <input
                    type="text"
                    name="fullName"
                    value={formData.fullName}
                    onChange={handleInputChange}
                    className={`w-full px-4 py-3 text-right border-2 rounded-lg focus:outline-none focus:border-primary transition-colors ${
                      errors.fullName ? 'border-red-500' : 'border-gray-200'
                    }`}
                    placeholder="أدخل اسمك الكامل"
                  />
                  {errors.fullName && (
                    <p className="text-red-500 text-sm text-right mt-1">{errors.fullName}</p>
                  )}
                </div>

                {/* Phone */}
                <div className="mb-4">
                  <label className="block text-right text-gray-700 font-bold mb-2">
                    رقم الهاتف *
                  </label>
                  <input
                    type="tel"
                    name="phone"
                    value={formData.phone}
                    onChange={handleInputChange}
                    className={`w-full px-4 py-3 text-right border-2 rounded-lg focus:outline-none focus:border-primary transition-colors ${
                      errors.phone ? 'border-red-500' : 'border-gray-200'
                    }`}
                    placeholder="05XX XXX XXX"
                  />
                  {errors.phone && (
                    <p className="text-red-500 text-sm text-right mt-1">{errors.phone}</p>
                  )}
                </div>

                {/* Wilaya */}
                <div className="mb-4">
                  <label className="block text-right text-gray-700 font-bold mb-2">
                    الولاية *
                  </label>
                  <select
                    name="wilaya"
                    value={formData.wilaya}
                    onChange={handleInputChange}
                    className={`w-full px-4 py-3 text-right border-2 rounded-lg focus:outline-none focus:border-primary transition-colors appearance-none cursor-pointer ${
                      errors.wilaya ? 'border-red-500' : 'border-gray-200'
                    }`}
                  >
                    <option value="">اختر الولاية</option>
                    {Object.keys(wilayasWithCommunes).sort().map((wilaya, index) => (
                      <option key={index} value={wilaya}>
                        {wilaya}
                      </option>
                    ))}
                  </select>
                  {errors.wilaya && (
                    <p className="text-red-500 text-sm text-right mt-1">{errors.wilaya}</p>
                  )}
                </div>

                {/* Commune */}
                <div className="mb-4">
                  <label className="block text-right text-gray-700 font-bold mb-2">
                    البلدية *
                  </label>
                  <select
                    name="commune"
                    value={formData.commune}
                    onChange={handleInputChange}
                    disabled={!formData.wilaya}
                    className={`w-full px-4 py-3 text-right border-2 rounded-lg focus:outline-none focus:border-primary transition-colors appearance-none cursor-pointer ${
                      errors.commune ? 'border-red-500' : 'border-gray-200'
                    } ${!formData.wilaya ? 'bg-gray-100 cursor-not-allowed' : ''}`}
                  >
                    <option value="">
                      {formData.wilaya ? 'اختر البلدية' : 'اختر الولاية أولاً'}
                    </option>
                    {communes.map((commune, index) => (
                      <option key={index} value={commune}>
                        {commune}
                      </option>
                    ))}
                  </select>
                  {errors.commune && (
                    <p className="text-red-500 text-sm text-right mt-1">{errors.commune}</p>
                  )}
                </div>
              </div>

              {/* Delivery Type */}
              <div className="bg-white rounded-xl p-6 shadow-sm">
                <h2 className="text-xl font-bold text-right mb-6 flex items-center justify-end gap-2">
                  <Truck size={24} />
                  نوع التوصيل
                </h2>

                <div className="grid grid-cols-2 gap-4">
                  <button
                    type="button"
                    onClick={() => setFormData(prev => ({ ...prev, deliveryType: 'office' }))}
                    className={`p-4 rounded-lg border-2 transition-all ${
                      formData.deliveryType === 'office'
                        ? 'border-primary bg-primary/5'
                        : 'border-gray-200 hover:border-gray-300'
                    }`}
                  >
                    <div className="flex flex-col items-center gap-2">
                      <MapPin size={24} className={formData.deliveryType === 'office' ? 'text-primary' : 'text-gray-600'} />
                      <span className="font-bold">استلام من المكتب</span>
                    </div>
                  </button>

                  <button
                    type="button"
                    onClick={() => setFormData(prev => ({ ...prev, deliveryType: 'home' }))}
                    className={`p-4 rounded-lg border-2 transition-all ${
                      formData.deliveryType === 'home'
                        ? 'border-primary bg-primary/5'
                        : 'border-gray-200 hover:border-gray-300'
                    }`}
                  >
                    <div className="flex flex-col items-center gap-2">
                      <Home size={24} className={formData.deliveryType === 'home' ? 'text-primary' : 'text-gray-600'} />
                      <span className="font-bold">توصيل للمنزل</span>
                    </div>
                  </button>
                </div>
              </div>

              {/* Payment Info */}
              <div className="bg-primary/10 rounded-xl p-6 border-2 border-primary/20">
                <div className="flex items-center justify-end gap-3 mb-3">
                  <h3 className="font-bold text-lg">الدفع عند الاستلام</h3>
                  <CreditCard size={24} className="text-primary" />
                </div>
                <p className="text-right text-gray-700">
                  سيتم الدفع عند استلام المنتج
                </p>
              </div>

              {/* Submit Button */}
              <button
                type="submit"
                className="w-full bg-dark text-white py-4 rounded-xl font-bold text-lg
                hover:bg-primary transition-all active:scale-95 shadow-lg hover:shadow-xl"
              >
                تأكيد الطلب
              </button>
            </form>
          </div>

          {/* Order Summary */}
          <div className="space-y-6">
            <div className="bg-white rounded-xl p-6 shadow-sm sticky top-24">
              <h2 className="text-xl font-bold text-right mb-6 flex items-center justify-end gap-2">
                <ShoppingBag size={24} />
                ملخص الطلب
              </h2>

              {/* Cart Items */}
              <div className="space-y-4 mb-6 max-h-96 overflow-y-auto">
                {cartItems.map((item, index) => (
                  <div key={index} className="flex gap-4 items-center pb-4 border-b border-gray-100">
                    <div className="flex-1 text-right">
                      <h4 className="font-bold text-sm mb-1 line-clamp-1">{item.name}</h4>
                      {item.size && (
                        <p className="text-xs text-gray-500 mb-1">المقاس: {item.size}</p>
                      )}
                      <div className="flex items-center justify-end gap-2">
                        <span className="text-primary font-bold">{item.price}</span>
                        <span className="text-gray-500">×</span>
                        <span className="text-gray-700 font-bold">{item.quantity || 1}</span>
                      </div>
                    </div>
                    <img
                      src={getImageUrl(item.imageName)}
                      alt={item.name}
                      className="w-20 h-20 object-cover rounded-lg"
                    />
                  </div>
                ))}
              </div>

              {/* Price Breakdown */}
              <div className="space-y-3 border-t border-gray-200 pt-4">
                <div className="flex justify-between items-center">
                  <span className="font-bold text-gray-900">{subtotal.toLocaleString()} DA</span>
                  <span className="text-gray-600">المجموع الفرعي</span>
                </div>
                <div className="flex justify-between items-center">
                  <span className="font-bold text-green-600">{deliveryFee} DA</span>
                  <span className="text-gray-600">رسوم التوصيل</span>
                </div>
                <div className="flex justify-between items-center pt-3 border-t-2 border-gray-200">
                  <span className="text-2xl font-black text-primary">{total.toLocaleString()} DA</span>
                  <span className="text-xl font-bold text-gray-900">المجموع الكلي</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default Checkout;